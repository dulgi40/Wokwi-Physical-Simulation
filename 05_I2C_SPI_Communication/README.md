# 📑 05_I2C_SPI_Communication

## 📌 要約

組込み設計においては、用途に応じた通信方式の選択が重要である。  
本実習では、UART以外の代表的な通信プロトコルであるI2CおよびSPIについて、構造理解と基本的な実装経験を得ることを目的とした。

---

## 🚀 1. 背景と目的

組込みシステムでは、UART、SPI、I2Cなどの通信プロトコルが広く使用されている。  
用途や通信速度、接続構成に応じて適切な方式を選択することが重要である。

### ■ I2Cの特徴

- 信号線は2本（SCL：クロック、SDA：データ）
- クロックを共有する同期式通信
- 1つのマスタに対して複数のスレーブを接続可能（1:N構成）
- アドレスベースでスレーブを識別

短所としては通信速度が比較的遅い点や、プルアップ抵抗が必要な点が挙げられる。  
主な用途は以下の通りである。

- 各種センサ接続
- EEPROM（設定値保存）
- RTC（リアルタイムクロック）

---

### ■ SPIの特徴

- 信号線は4本（MOSI、MISO、SCK、CS）
- クロック同期式通信
- アドレス概念はなく、CS信号でスレーブを選択
- 全二重通信（Full-Duplex）

高速通信が可能であり、主な用途は以下である。

- SDカード
- TFT / LCDディスプレイ
- 高速ADC / DAC
- 外部Flashメモリ

---

## 🔍 2. 課題

I2CおよびSPIの基本動作を理解するため、以下の検証を行った。

- I2C：ESP32とI2C接続されたLCDモジュールに対し、ACK応答を利用したアドレス検出（I2Cスキャナ）を実装
- SPI：4ピン構成のLoopback回路を構築し、送信データと受信データの一致を確認することで全二重通信構造を検証

---

## 🛠 3. 解決策と実装

### ■ I2C実装

- `Wire`ライブラリを使用
- 各アドレスに対しSTART信号とアドレス送信を行い、ACK応答の有無でデバイス存在を確認
- 検出されたアドレスをシリアル出力およびLCDに表示

### ■ SPI実装

- SPIライブラリを使用
- MOSIとMISOを物理的に接続したLoopback構成
- `SPI.transfer()`により送信と同時に受信を行い、送受信データの一致を確認
- SPIの全二重通信特性を検証

---

## ▶️ 4. 動作確認

### I2C

- LCDモジュールのアドレス検出成功
- シリアルモニタおよびLCDに表示

![/I2C_Address_Scanner.gif]

### SPI

- 送信データと受信データが一致することを確認
- 全二重通信動作を検証

![SPI.gif]

---

## 💡 5. 考察

UART / I2C / SPIの比較整理を行った。

| 項目 | UART | I2C | SPI |
|------|------|------|------|
| 通信方式 | 非同期 | 同期 | 同期 |
| 多デバイス接続 | × | ○（アドレス） | ○（CS） |
| 全二重通信 | × | × | ○ |
| 主な用途 | ログ出力 | センサ接続 | 高速データ転送 |

本実習を通じて、通信方式は単純な速度比較ではなく、用途・構成・配線本数・制御方式を考慮して選択する必要があることを理解した。
